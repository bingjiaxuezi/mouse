# 小鼠行为记录系统共识文档

## 明确的需求描述

### 核心功能需求
1. **测试数据管理**: 为t_behavior_data、t_position_track、t_physiological_state表添加完整的测试数据
2. **行为记录展示系统**: 创建完整的前后端展示系统，支持行为数据的查询和统计
3. **双入口访问**: 
   - 系统管理菜单下的独立"行为管理"页面
   - 小鼠详情页面集成的行为信息展示
4. **数据统计汇总**: 24小时内行为类型统计（基础行为、社交行为、异常行为）
5. **详细记录列表**: 按时间倒序展示行为记录，包含小鼠信息和状态

### 页面功能规格
- **汇总区域**: 显示选定时间范围内的行为统计数据
- **列表区域**: 分页展示行为记录详情
- **筛选功能**: 支持按小鼠、时间范围、行为类型筛选
- **状态展示**: 显示小鼠最新的生理状态和生命状态

## 技术实现方案

### 后端架构设计
```
包结构:
com.ruoyi.system.domain
├── TBehaviorData.java (行为数据实体)
├── TBehaviorType.java (行为类型实体)
├── TPositionTrack.java (位置轨迹实体)
├── TPhysiologicalState.java (生理状态实体)
├── dto/
│   ├── BehaviorQueryDTO.java (查询参数)
│   └── BehaviorStatisticsDTO.java (统计参数)
└── vo/
    ├── BehaviorDataVO.java (行为数据视图)
    ├── BehaviorStatisticsVO.java (统计结果视图)
    └── MouseBehaviorSummaryVO.java (小鼠行为汇总视图)

com.ruoyi.system.mapper
├── TBehaviorDataMapper.java
├── TBehaviorTypeMapper.java
├── TPositionTrackMapper.java
└── TPhysiologicalStateMapper.java

com.ruoyi.system.service
├── ITBehaviorDataService.java
└── impl/TBehaviorDataServiceImpl.java

com.ruoyi.web.controller.system
└── TBehaviorController.java
```

### 前端页面设计
```
页面结构:
templates/system/behavior/
├── behavior.html (独立行为管理页面)
├── mouse-behavior.html (小鼠行为详情页面)
└── components/
    ├── behavior-statistics.html (统计组件)
    └── behavior-list.html (列表组件)

templates/system/mouse/
└── detail.html (修改：集成行为信息)
```

### 数据库查询优化
```sql
-- 核心查询语句
1. 行为统计查询 (按类型分组统计)
2. 行为列表查询 (多表关联分页)
3. 小鼠最新状态查询
4. 时间范围筛选查询

-- 性能优化索引
CREATE INDEX idx_behavior_mouse_time ON t_behavior_data(mouse_code, timestamp DESC);
CREATE INDEX idx_behavior_type_time ON t_behavior_data(behavior_type_id, timestamp DESC);
CREATE INDEX idx_physio_mouse_time ON t_physiological_state(mouse_code, timestamp DESC);
```

## 技术约束

### 框架约束
- **后端框架**: 严格遵循RuoYi框架规范
- **前端技术**: 使用Thymeleaf + jQuery + Bootstrap
- **数据库**: MySQL 8.0，使用MyBatis进行数据访问
- **权限控制**: 集成Shiro权限系统
- **部署方式**: 支持Docker Compose一键部署

### 代码规范约束
- **命名规范**: 遵循Java驼峰命名和数据库下划线命名
- **注解使用**: 使用Lombok简化代码，使用@RequiresPermissions控制权限
- **异常处理**: 统一使用AjaxResult返回格式
- **日志记录**: 使用@Log注解记录操作日志

### 性能约束
- **查询优化**: 大数据量查询必须使用分页
- **索引设计**: 为常用查询字段建立合适索引
- **缓存策略**: 行为类型字典数据可考虑缓存

## 集成方案

### 与现有系统集成
1. **数据库集成**: 通过mouse_code外键与t_mouse表关联
2. **权限集成**: 新增behavior相关权限点，集成到现有权限体系
3. **菜单集成**: 在系统管理模块下添加行为管理菜单项
4. **样式集成**: 复用现有Bootstrap主题和组件样式

### 小鼠详情页集成
- 在小鼠详情页添加"行为信息"标签页
- 显示该小鼠的行为统计和最近记录
- 提供跳转到完整行为管理页面的链接

## 任务边界限制

### 包含功能
✅ 完整的行为数据展示系统
✅ 行为统计和汇总功能
✅ 双入口页面设计
✅ 测试数据生成
✅ 数据库脚本更新
✅ 一键部署验证

### 不包含功能
❌ 行为数据的增删改操作
❌ 实时数据采集功能
❌ 复杂的数据可视化图表
❌ 行为模式分析算法
❌ 数据导出功能
❌ 移动端适配

## 验收标准

### 功能验收标准
1. **数据完整性**:
   - [ ] 数据库包含至少50条行为记录测试数据
   - [ ] 涵盖所有19种行为类型
   - [ ] 包含多个小鼠的数据
   - [ ] 时间跨度覆盖最近7天

2. **页面功能**:
   - [ ] 独立行为管理页面正常访问和展示
   - [ ] 小鼠详情页行为信息正确集成
   - [ ] 24小时行为统计数据准确
   - [ ] 行为记录列表按时间倒序正确显示
   - [ ] 分页功能正常工作
   - [ ] 筛选功能正确响应

3. **交互体验**:
   - [ ] 页面加载速度小于3秒
   - [ ] 所有按钮和链接正常响应
   - [ ] 错误提示信息友好
   - [ ] 页面布局在不同屏幕尺寸下正常显示

### 技术验收标准
1. **代码质量**:
   - [ ] 所有Java类遵循RuoYi命名规范
   - [ ] 使用适当的注解和注释
   - [ ] 异常处理完善
   - [ ] 无明显的代码重复

2. **API接口**:
   - [ ] 所有接口返回正确的JSON格式
   - [ ] 权限控制正确生效
   - [ ] 参数验证完善
   - [ ] 错误码定义清晰

3. **数据库**:
   - [ ] 查询语句性能良好（执行时间<1秒）
   - [ ] 外键约束正确设置
   - [ ] 索引设计合理
   - [ ] 数据一致性保证

### 集成验收标准
1. **系统集成**:
   - [ ] 与现有小鼠管理系统无冲突
   - [ ] 权限系统正确集成
   - [ ] 菜单显示正常
   - [ ] 样式风格一致

2. **部署验证**:
   - [ ] 一键部署脚本执行成功
   - [ ] Docker容器正常启动
   - [ ] 数据库初始化成功
   - [ ] 前后端联调通过

## 确认的关键假设

### 数据假设
- 行为数据只用于展示，不需要提供编辑功能
- 测试数据可以使用模拟数据，不需要真实采集数据
- 统计时间范围默认24小时，支持自定义选择

### 技术假设
- 现有RuoYi框架版本支持所需功能
- 数据库性能足以支持预期的查询负载
- 前端不需要复杂的单页应用功能

### 业务假设
- 用户主要关注最近的行为数据
- 行为类型分类（基础、社交、异常）已在数据库中定义
- 小鼠状态信息包括生理指标和生命状态

## 风险缓解策略

### 技术风险
- **多表查询性能**: 通过合理的索引设计和查询优化解决
- **前端兼容性**: 使用成熟的Bootstrap组件确保兼容性
- **数据一致性**: 通过外键约束和事务控制保证

### 集成风险
- **权限冲突**: 仔细设计权限点，避免与现有权限冲突
- **菜单影响**: 在测试环境充分验证菜单修改的影响
- **样式冲突**: 复用现有样式类，避免自定义样式

### 部署风险
- **数据库迁移**: 通过初始化脚本确保数据库结构正确
- **容器启动**: 验证所有依赖服务正常启动
- **配置冲突**: 确保新增配置不影响现有功能

## 最终确认清单

### 需求确认
- [x] 功能范围明确，边界清晰
- [x] 技术方案可行，与现有架构兼容
- [x] 验收标准具体，可测试验证
- [x] 风险识别完整，缓解策略明确

### 技术确认
- [x] 数据库设计合理，外键关系正确
- [x] 后端架构清晰，符合框架规范
- [x] 前端设计简洁，用户体验良好
- [x] 集成方案完整，影响范围可控

### 交付确认
- [x] 开发计划合理，时间估算准确
- [x] 质量标准明确，验收流程清晰
- [x] 部署方案完整，一键部署可行
- [x] 文档齐全，便于后续维护

---

**共识达成时间**: 2025-01-21
**预计完成时间**: 3小时
**质量目标**: 零缺陷交付，一次性通过验收
**成功标准**: 一键部署成功，所有功能正常运行