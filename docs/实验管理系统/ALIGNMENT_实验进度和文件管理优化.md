# 实验进度记录表和文件管理表优化需求分析

## 📋 原始需求

用户对当前的实验进度记录表和实验文件管理表提出了优化需求：

### 🔄 实验进度记录表优化需求

**当前问题**：
- 现有表只是简单记录实验进度情况
- 无法满足实际实验管理需求

**新需求**：
1. **定时任务支持**：每天执行定时任务，自动拉取当前实验状态
2. **汇总报告生成**：生成类似日报的汇总数据
3. **笼子状态汇总**：在实验A中的笼子情况汇总
4. **小鼠状态汇总**：在实验A中的小鼠状态汇总
5. **综合状态分析**：不仅仅是进度记录，而是全面的实验状态分析

### 📁 实验文件管理表优化需求

**当前问题**：
- 只是简单的文件分类管理
- 缺乏与实验详情的深度关联

**新需求**：
1. **备忘录形式管理**：作为实验详情的一部分进行管理
2. **多类型文件支持**：用户可以添加图片文件、数据文件等
3. **归并展示**：文件作为备忘录形式归并展示
4. **实验关联性**：与具体实验紧密关联，而非独立分类

## 🎯 核心诉求总结

1. **日报数据库支持**：可以生成类似于日报的数据库记录
2. **文件备忘录管理**：关联该实验的文件，类似备忘录形式管理
3. **深度集成**：与现有实验管理系统深度集成

## 🔍 现有项目分析

### 相关表结构
- `sys_experiment`：实验主表
- `sys_cage`：笼子管理表
- `sys_mouse`：小鼠管理表
- `sys_experiment_cage`：实验笼子关系表

### 技术栈
- Spring Boot + MyBatis-Plus
- MySQL数据库
- 定时任务支持（Spring Schedule）
- 文件存储（MinIO）

## ❓ 需要确认的问题

### 实验进度记录相关
1. **定时任务频率**：每天几点执行定时任务？
2. **汇总数据范围**：除了笼子和小鼠状态，还需要汇总哪些数据？
3. **历史数据保留**：日报数据需要保留多长时间？
4. **报告格式**：汇总报告需要什么格式（JSON、结构化字段）？

### 实验文件管理相关
1. **文件类型限制**：支持哪些文件类型和大小限制？
2. **权限控制**：文件的查看和编辑权限如何控制？
3. **版本管理**：同一文件的多个版本如何管理？
4. **备忘录功能**：备忘录需要支持富文本编辑吗？

### 系统集成相关
1. **现有数据迁移**：如何处理现有的进度和文件数据？
2. **API接口**：前端需要哪些新的API接口？
3. **通知机制**：日报生成后是否需要通知相关人员？

## 🏗️ 初步设计思路

### 实验日报系统
- 新增实验日报主表
- 新增笼子状态汇总表
- 新增小鼠状态汇总表
- 定时任务自动生成日报数据

### 实验备忘录系统
- 重构实验文件管理表
- 新增备忘录条目表
- 支持文件与备忘录的关联
- 提供备忘录的CRUD操作

## 最终确定方案

经过讨论，确定了简化的实验记录系统方案：

### 保留内容
- **实验记录表** (sys_experiment_record)：原实验日报主表，增加小鼠指标字段
- **实验文件管理表** (sys_experiment_file)：优化后支持多媒体文件管理

### 移除内容
- 实验笼子状态汇总表 (过于复杂)
- 实验小鼠状态汇总表 (过于复杂)
- 实验备忘录主表 (功能重复)

### 核心功能
1. **实验列表增加"实验记录"按钮**
2. **点击后查看该实验的所有记录**
3. **支持富文本、图像、视频、文件等多媒体内容**
4. **考虑使用MinIO实现文件存储**

## 实施完成情况

✅ **数据库表结构优化完成**
- 将 sys_experiment_progress 重构为 sys_experiment_record
- 增加小鼠指标字段 (total_mice, active_mice, healthy_mice等)
- 增加富文本内容字段 (record_content)
- 优化 sys_experiment_file 表，增加文件关联和分类字段

✅ **索引和视图优化**
- 添加性能优化索引
- 创建实验记录汇总视图
- 创建实验文件统计视图

✅ **测试数据和文档**
- 插入示例实验记录数据
- 完善表注释和说明

## 下一步开发建议

1. **后端API开发**
   - 实验记录CRUD接口
   - 文件上传和管理接口
   - MinIO集成

2. **前端界面开发**
   - 实验列表添加"实验记录"按钮
   - 实验记录详情页面
   - 富文本编辑器
   - 多媒体文件上传和预览

3. **系统集成**
   - 与现有实验管理模块集成
   - 权限控制
   - 数据备份策略