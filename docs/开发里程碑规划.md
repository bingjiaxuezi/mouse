# 实验驱动小鼠管理系统开发里程碑规划

## 项目概述

**开发团队规模：**
- 第1个月：1人开发（您）
- 第2个月开始：2人开发团队
- 数据标注：第2个月开始

**实验驱动开发策略：**
- 优先开发实验驱动架构的Spring Boot后端项目
- 集成实验管理和二维码管理功能
- 使用实验假数据进行开发和测试
- 采用实验驱动敏捷开发模式，快速迭代

## 已完成阶段：实验管理系统研究员功能优化（2025年1月）

### 目标
完成实验管理系统的研究员选择和显示功能优化，提升用户体验

### 主要任务

#### 1. 研究员选择器功能实现
- [x] **在新增实验页面实现研究员选择器**
  - 参考邮件模板编辑页面的人员选择功能
  - 支持多选研究员功能
  - 提供良好的用户交互体验
- [x] **在编辑实验页面实现研究员选择器**
  - 支持已选择研究员的回显功能
  - 保持与新增页面一致的交互体验

#### 2. 后端研究员名称转换功能
- [x] **添加研究员ID转名称的后端接口**
  - 在SysExperimentController中新增getResearcherName接口
  - 通过sysUserService.selectUserById实现ID到姓名的转换
  - 支持前端显示需求

#### 3. 列表页面显示优化
- [x] **简化列表页面研究员显示**
  - 移除列表页面中主要研究员和协助研究员的显示列
  - 移除搜索条件中的主要研究员下拉选择框
  - 保持其他功能不变，简化页面展示

#### 4. 前端页面样式改善
- [x] **优化页面用户体验**
  - 改善搜索区域布局和按钮样式
  - 优化表格显示效果
  - 统一页面视觉风格

### 交付物
- 完整的研究员选择器功能
- 优化的实验管理页面用户体验
- 简化的列表页面显示
- 后端研究员名称转换接口

### 技术实现要点
- **后端接口**：新增研究员名称查询接口，支持ID到姓名的转换
- **前端交互**：实现了人员选择器组件，支持多选和回显
- **页面简化**：按需求移除了研究员相关的复杂显示功能
- **样式优化**：提升了整体页面的用户体验

---

## 第一阶段：实验驱动基础架构搭建（第1-2周）

### 目标
建立实验驱动项目基础架构，完成实验核心框架搭建

### 主要任务

#### 1. 实验驱动项目初始化
- [ ] 基于RuoYi-Vue-Plus创建实验管理项目骨架
- [ ] 配置实验开发环境（Docker环境）
- [ ] 设置实验代码规范和Git工作流
- [ ] 配置实验CI/CD基础流程

#### 2. 实验数据库设计与实现
- [ ] 完善实验数据库表结构设计
- [ ] 编写实验数据库初始化脚本
- [ ] 配置实验数据库连接和事务管理
- [ ] 实现实验数据库版本管理（Flyway）

#### 3. 实验基础模块开发
- [ ] 实验用户管理模块（基于RuoYi）
- [ ] 实验权限管理模块
- [ ] **实验管理核心模块（实验创建、配置、模板）**
- [ ] 实验系统配置模块
- [ ] 实验日志管理模块
- [ ] 实验二维码生成和管理模块（实验、小鼠、鼠笼、设备标识）

### 交付物
- 可运行的实验驱动Spring Boot项目
- 完整的实验数据库结构
- 基础的实验用户认证和权限管理
- 实验开发环境Docker配置

## 第二阶段：实验驱动核心业务模块开发（第3-4周）

### 目标
实现实验驱动核心业务功能，建立完整的实验API体系

### 主要任务

#### 1. 实验管理核心模块（最高优先级）
- [ ] **实验模板创建和管理**
- [ ] **实验智能配置和参数设置**
- [ ] **实验启动和状态管理**
- [ ] **实验进度智能跟踪**
- [ ] **实验绑定管理（设备、鼠笼、小鼠）**
- [ ] **实验报告智能生成**

#### 2. 实验设备管理模块
- [ ] **实验设备注册和认证**
- [ ] **实验设备与实验绑定**
- [ ] 实验设备状态监控
- [ ] 实验设备配置管理
- [ ] 实验设备心跳机制

#### 3. 实验实体管理模块
- [ ] **实验鼠笼管理和绑定**
- [ ] **实验小鼠信息管理和绑定**
- [ ] **实验二维码标签管理（实验、小鼠、鼠笼标识）**
- [ ] **实验计划制定和执行**

#### 4. 实验数据接收模块
- [ ] **实验行为数据接收API**
- [ ] **实验数据验证和清洗**
- [ ] **实验批量数据处理**
- [ ] **实验数据存储优化**

### 交付物
- 完整的实验管理核心功能
- 实验设备管理功能
- 实验和小鼠管理功能
- 实验数据接收和存储功能
- 实验API文档（APIFOX）

## 第三阶段：实验数据分析与智能展示（第5-6周）

### 目标
实现实验数据分析和可视化功能

### 主要任务

#### 1. 实验数据分析模块
- [ ] **实验行为统计分析**
- [ ] **实验趋势分析算法**
- [ ] **实验异常检测机制**
- [ ] **实验报表生成功能**
- [ ] **实验AI智能分析**

#### 2. 实验驱动前端开发
- [ ] **实验驱动仪表板界面**
- [ ] **实验创建和管理界面**
- [ ] **实验绑定管理界面**
- [ ] **实验智能监控界面**
- [ ] **实验数据可视化图表**
- [ ] **实验报告生成界面**
- [ ] 实验管理后台界面
- [ ] 实验实时监控界面
- [ ] 移动端实验适配准备
- [ ] 实验二维码扫描和管理界面

#### 3. 实验实时通信
- [ ] **实验WebSocket实时推送**
- [ ] **实验消息队列集成**
- [ ] **实验实时告警机制**
- [ ] **实验状态实时更新**

### 交付物
- 实验数据分析和统计功能
- 完整的实验驱动Web前端界面
- 实验实时数据推送功能

## 第四阶段：实验系统集成与优化（第7-8周）

### 目标
实验系统集成测试，实验性能优化，准备实验生产部署

### 主要任务

#### 1. 实验系统集成
- [ ] **实验Python采集端模拟器开发**
- [ ] **实验端到端测试**
- [ ] **实验性能压力测试**
- [ ] **实验安全性测试**
- [ ] **实验流程完整性测试**

#### 2. 实验数据标注准备
- [ ] **实验标注工具集成（CVAT）**
- [ ] **实验标注任务管理**
- [ ] **实验标注质量控制**
- [ ] **实验标注数据导出**
- [ ] **实验数据集构建**

#### 3. 实验部署优化
- [ ] **实验Docker镜像优化**
- [ ] **实验生产环境配置**
- [ ] **实验监控和日志系统**
- [ ] **实验备份和恢复机制**
- [ ] **实验性能调优**

### 交付物
- 完整的实验系统集成测试
- 生产就绪的实验Docker镜像
- 实验标注工具和流程
- 实验部署和运维文档

## 实验驱动Spring Boot项目Model划分

### 1. 实验核心实体模型

#### 1.1 实验用户管理模块
```java
// 实验用户实体
@Entity
@Table(name = "t_experiment_user")
public class ExperimentUser extends BaseEntity {
    private Long userId;
    private String username;
    private String password;
    private String email;
    private String phone;
    private String realName;
    private String avatar;
    private Integer status;
    private String roles;
    private Date lastLoginTime;
    private String institution; // 实验机构
    private String researchField; // 研究领域
    // getter/setter...
}

// 实验角色实体
@Entity
@Table(name = "t_experiment_role")
public class ExperimentRole extends BaseEntity {
    private Long roleId;
    private String roleName;
    private String roleKey;
    private String description;
    private Integer status;
    private List<Permission> permissions;
    private String experimentScope; // 实验权限范围
    // getter/setter...
}
```

#### 1.2 实验二维码管理模块
```java
// 实验二维码实体
@Entity
@Table(name = "t_experiment_qr_code")
public class ExperimentQrCode extends BaseEntity {
    private Long qrCodeId;
    private String qrCodeData; // 二维码数据内容
    private String qrCodeType; // experiment, mouse, cage, device
    private String targetId; // 关联的目标ID（实验ID、小鼠ID、鼠笼ID等）
    private String experimentId; // 关联的实验ID
    private byte[] qrCodeImage; // 二维码图片
    private String imageUrl; // 图片存储URL
    private Integer status; // 0-无效 1-有效
    private String description;
    private Date generatedTime; // 生成时间
    private String generatedBy; // 生成人
    // getter/setter...
}

// 实验二维码扫描记录
@Entity
@Table(name = "t_experiment_qr_scan_log")
public class ExperimentQrScanLog extends BaseEntity {
    private Long scanId;
    private String qrCodeData;
    private String experimentId; // 关联的实验ID
    private String scanUserId;
    private String deviceInfo;
    private String location;
    private Date scanTime;
    private String scanResult;
    private String experimentContext; // 实验上下文
    // getter/setter...
}
```

#### 1.3 实验设备管理模块
```java
// 实验设备实体
@Entity
@Table(name = "t_experiment_device")
public class ExperimentDevice extends BaseEntity {
    private String deviceId;
    private String deviceName;
    private String deviceType;
    private String location;
    private String macAddress;
    private String ipAddress;
    private Integer status;
    private String capabilities;
    private String hardwareInfo;
    private String configInfo;
    private Date lastHeartbeat;
    private String deviceToken;
    private String apiKey;
    private String currentExperimentId; // 当前绑定的实验ID
    private String experimentHistory; // 实验历史记录
    // getter/setter...
}

// 实验设备状态实体
@Entity
@Table(name = "t_experiment_device_status")
public class ExperimentDeviceStatus extends BaseEntity {
    private Long statusId;
    private String deviceId;
    private String experimentId; // 关联的实验ID
    private Date timestamp;
    private String status;
    private Double cpuUsage;
    private Double memoryUsage;
    private Double gpuUsage;
    private Double diskUsage;
    private Double temperature;
    private Double fps;
    private Integer detectionCount;
    private Double trackingAccuracy;
    private String experimentPhase; // 实验阶段
    // getter/setter...
}
```

#### 1.4 实验管理核心模块
```java
// 实验项目实体（核心）
@Entity
@Table(name = "t_experiment")
public class Experiment extends BaseEntity {
    private String experimentId;
    private String experimentName;
    private String description;
    private String researcherName;
    private String institution;
    private Date startTime;
    private Date endTime;
    private Integer status; // 0-草稿 1-进行中 2-暂停 3-完成 4-取消
    private String objectives;
    private String methodology;
    private String expectedResults;
    private String templateId; // 实验模板ID
    private String configJson; // 实验配置JSON
    private String qrCodeBatch; // 二维码批次号
    private Integer priority; // 实验优先级
    // getter/setter...
}

// 实验模板实体
@Entity
@Table(name = "t_experiment_template")
public class ExperimentTemplate extends BaseEntity {
    private String templateId;
    private String templateName;
    private String description;
    private String category; // 实验类别
    private String configSchema; // 配置模式JSON Schema
    private String defaultConfig; // 默认配置JSON
    private String instructions; // 实验说明
    private Integer status; // 0-草稿 1-发布
    // getter/setter...
}

// 实验鼠笼实体
@Entity
@Table(name = "t_experiment_cage")
public class ExperimentCage extends BaseEntity {
    private String cageId;
    private String cageName;
    private String experimentId; // 绑定的实验ID
    private String deviceId; // 绑定的设备ID
    private String cageType;
    private String environment;
    private Integer capacity;
    private Integer currentCount;
    private String location;
    private String description;
    private Date bindTime; // 绑定时间
    private String bindStatus; // 绑定状态
    // getter/setter...
}

// 实验小鼠实体
@Entity
@Table(name = "t_experiment_mouse")
public class ExperimentMouse extends BaseEntity {
    private String mouseId;
    private String mouseName;
    private String cageId; // 绑定的鼠笼ID
    private String experimentId; // 绑定的实验ID
    private String strain;
    private String gender;
    private Integer age;
    private Double weight;
    private String healthStatus;
    private String geneticBackground;
    private String treatmentGroup;
    private Date birthDate;
    private String description;
    private Date bindTime; // 绑定时间
    private String bindStatus; // 绑定状态
    private String experimentGroup; // 实验分组
    // getter/setter...
}
```

#### 1.5 实验行为数据模块
```java
// 实验行为数据实体
@Entity
@Table(name = "t_experiment_behavior_data")
public class ExperimentBehaviorData extends BaseEntity {
    private Long dataId;
    private String mouseId;
    private String deviceId;
    private String cageId;
    private String experimentId; // 关联的实验ID
    private Date timestamp;
    private Double positionX;
    private Double positionY;
    private Double positionConfidence;
    private String behaviorType;
    private Double behaviorConfidence;
    private Integer behaviorDuration;
    private Double velocity;
    private Double acceleration;
    private Double direction;
    private String environmentalData;
    private String rawData;
    private String experimentPhase; // 实验阶段
    private String dataQuality; // 数据质量标记
    // getter/setter...
}

// 实验行为统计实体
@Entity
@Table(name = "t_experiment_behavior_statistics")
public class ExperimentBehaviorStatistics extends BaseEntity {
    private Long statisticsId;
    private String mouseId;
    private String experimentId; // 关联的实验ID
    private Date statisticsDate;
    private String behaviorType;
    private Integer totalCount;
    private Long totalDuration;
    private Double averageDuration;
    private Double frequency;
    private String timeDistribution;
    private String additionalMetrics;
    private String experimentGroup; // 实验分组
    private String comparisonData; // 对比数据
    // getter/setter...
}
```

#### 1.6 实验标注管理模块
```java
// 实验标注任务实体
@Entity
@Table(name = "t_experiment_annotation_task")
public class ExperimentAnnotationTask extends BaseEntity {
    private String taskId;
    private String taskName;
    private String experimentId; // 关联的实验ID
    private String assigneeId;
    private String taskType;
    private Integer status;
    private String videoPath;
    private Date startTime;
    private Date endTime;
    private String instructions;
    private Integer priority;
    private Double progress;
    private String experimentContext; // 实验上下文
    private String qualityRequirement; // 质量要求
    // getter/setter...
}

// 实验标注结果实体
@Entity
@Table(name = "t_experiment_annotation_result")
public class ExperimentAnnotationResult extends BaseEntity {
    private Long resultId;
    private String taskId;
    private String annotatorId;
    private String experimentId; // 关联的实验ID
    private Date timestamp;
    private String mouseId;
    private String behaviorType;
    private Double confidence;
    private String boundingBox;
    private String keyPoints;
    private String notes;
    private Integer quality;
    private String experimentPhase; // 实验阶段
    private String validationStatus; // 验证状态
    // getter/setter...
}
```

### 2. 实验驱动核心接口定义

#### 2.1 实验管理接口（核心优先级）
```java
@RestController
@RequestMapping("/api/experiment")
@Api(tags = "实验管理")
public class ExperimentController {
    
    @PostMapping("/create")
    @ApiOperation("创建实验")
    public R<Experiment> createExperiment(@RequestBody CreateExperimentRequest request) {
        // 实验创建逻辑
    }
    
    @PostMapping("/template/{templateId}/apply")
    @ApiOperation("应用实验模板")
    public R<Experiment> applyExperimentTemplate(@PathVariable String templateId, @RequestBody ApplyTemplateRequest request) {
        // 应用模板逻辑
    }
    
    @PostMapping("/{experimentId}/start")
    @ApiOperation("启动实验")
    public R<Void> startExperiment(@PathVariable String experimentId) {
        // 实验启动逻辑
    }
    
    @PostMapping("/{experimentId}/bind/devices")
    @ApiOperation("绑定实验设备")
    public R<Void> bindExperimentDevices(@PathVariable String experimentId, @RequestBody BindDevicesRequest request) {
        // 设备绑定逻辑
    }
    
    @PostMapping("/{experimentId}/bind/cages")
    @ApiOperation("绑定实验鼠笼")
    public R<Void> bindExperimentCages(@PathVariable String experimentId, @RequestBody BindCagesRequest request) {
        // 鼠笼绑定逻辑
    }
    
    @PostMapping("/{experimentId}/bind/mice")
    @ApiOperation("绑定实验小鼠")
    public R<Void> bindExperimentMice(@PathVariable String experimentId, @RequestBody BindMiceRequest request) {
        // 小鼠绑定逻辑
    }
    
    @PostMapping("/{experimentId}/qrcode/batch")
    @ApiOperation("批量生成实验二维码")
    public R<BatchQrCodeResponse> generateExperimentQrCodes(@PathVariable String experimentId) {
        // 实验二维码批量生成
    }
    
    @GetMapping("/{experimentId}/status")
    @ApiOperation("获取实验状态")
    public R<ExperimentStatusResponse> getExperimentStatus(@PathVariable String experimentId) {
        // 实验状态查询
    }
    
    @GetMapping("/{experimentId}/report")
    @ApiOperation("生成实验报告")
    public R<ExperimentReport> generateExperimentReport(@PathVariable String experimentId) {
        // 实验报告生成
    }
}
```

#### 2.2 实验二维码管理接口
```java
@RestController
@RequestMapping("/api/experiment/qrcode")
@Api(tags = "实验二维码管理")
public class ExperimentQrCodeController {
    
    @PostMapping("/generate")
    @ApiOperation("生成实验二维码")
    public R<QrCodeGenerateResponse> generateExperimentQrCode(@RequestBody ExperimentQrCodeGenerateRequest request) {
        // 实验二维码生成逻辑
    }
    
    @GetMapping("/scan/{qrCodeData}")
    @ApiOperation("扫描实验二维码")
    public R<ExperimentQrCodeScanResponse> scanExperimentQrCode(@PathVariable String qrCodeData) {
        // 实验扫描处理逻辑
    }
    
    @GetMapping("/experiment/{experimentId}")
    @ApiOperation("获取实验二维码信息")
    public R<List<ExperimentQrCode>> getExperimentQrCodes(@PathVariable String experimentId) {
        // 获取实验二维码信息
    }
    
    @PostMapping("/batch/generate")
    @ApiOperation("批量生成实验二维码")
    public R<BatchExperimentQrCodeResponse> batchGenerateExperimentQrCode(@RequestBody BatchExperimentQrCodeRequest request) {
        // 批量生成逻辑
    }
    
    @GetMapping("/scan/history")
    @ApiOperation("实验扫描历史记录")
    public TableDataInfo<ExperimentQrScanLog> getExperimentScanHistory(ExperimentQrScanQueryRequest request) {
        // 实验扫描历史查询
    }
}
```

#### 2.3 实验设备管理接口
```java
@RestController
@RequestMapping("/api/experiment/device")
@Api(tags = "实验设备管理")
public class ExperimentDeviceController {
    
    @PostMapping("/register")
    @ApiOperation("实验设备注册")
    public R<ExperimentDeviceRegisterResponse> registerExperimentDevice(@RequestBody ExperimentDeviceRegisterRequest request) {
        // 实验设备注册逻辑
    }
    
    @PostMapping("/bind/{deviceId}/experiment/{experimentId}")
    @ApiOperation("绑定设备到实验")
    public R<Void> bindDeviceToExperiment(@PathVariable String deviceId, @PathVariable String experimentId) {
        // 设备实验绑定逻辑
    }
    
    @PostMapping("/heartbeat")
    @ApiOperation("实验设备心跳")
    public R<Void> experimentDeviceHeartbeat(@RequestBody ExperimentDeviceHeartbeatRequest request) {
        // 实验心跳处理逻辑
    }
    
    @GetMapping("/config/{deviceId}")
    @ApiOperation("获取实验设备配置")
    public R<ExperimentDeviceConfig> getExperimentDeviceConfig(@PathVariable String deviceId) {
        // 获取实验配置逻辑
    }
    
    @GetMapping("/experiment/{experimentId}")
    @ApiOperation("获取实验设备列表")
    public R<List<ExperimentDevice>> getExperimentDevices(@PathVariable String experimentId) {
        // 实验设备列表查询
    }
    
    @PutMapping("/status/{deviceId}")
    @ApiOperation("更新实验设备状态")
    public R<Void> updateExperimentDeviceStatus(@PathVariable String deviceId, @RequestBody ExperimentDeviceStatusRequest request) {
        // 实验状态更新逻辑
    }
}
```

#### 2.4 实验行为数据接口
```java
@RestController
@RequestMapping("/api/experiment/behavior")
@Api(tags = "实验行为数据管理")
public class ExperimentBehaviorController {
    
    @PostMapping("/batch/upload")
    @ApiOperation("批量上报实验行为数据")
    public R<Void> batchUploadExperimentBehaviorData(@RequestBody BatchExperimentBehaviorDataRequest request) {
        // 实验批量数据上报逻辑
    }
    
    @GetMapping("/experiment/{experimentId}/statistics")
    @ApiOperation("实验行为统计查询")
    public R<ExperimentBehaviorStatisticsResponse> getExperimentBehaviorStatistics(@PathVariable String experimentId, ExperimentBehaviorStatisticsRequest request) {
        // 实验统计查询逻辑
    }
    
    @GetMapping("/experiment/{experimentId}/mouse/{mouseId}/timeline")
    @ApiOperation("获取实验小鼠行为时间线")
    public R<List<ExperimentBehaviorTimelineItem>> getExperimentBehaviorTimeline(@PathVariable String experimentId, @PathVariable String mouseId, ExperimentBehaviorTimelineRequest request) {
        // 实验时间线查询逻辑
    }
    
    @GetMapping("/experiment/{experimentId}/export")
    @ApiOperation("导出实验行为数据")
    public void exportExperimentBehaviorData(@PathVariable String experimentId, ExperimentBehaviorExportRequest request, HttpServletResponse response) {
        // 实验数据导出逻辑
    }
    
    @GetMapping("/experiment/{experimentId}/realtime/{deviceId}")
    @ApiOperation("实验实时行为数据流")
    public SseEmitter getExperimentRealtimeBehaviorData(@PathVariable String experimentId, @PathVariable String deviceId) {
        // 实验实时数据流
    }
    
    @GetMapping("/experiment/{experimentId}/quality/report")
    @ApiOperation("实验数据质量报告")
    public R<ExperimentDataQualityReport> getExperimentDataQualityReport(@PathVariable String experimentId) {
        // 实验数据质量报告
    }
}
```

#### 2.5 实验标注管理接口
```java
@RestController
@RequestMapping("/api/experiment/annotation")
@Api(tags = "实验标注管理")
public class ExperimentAnnotationController {
    
    @PostMapping("/task/create")
    @ApiOperation("创建实验标注任务")
    public R<ExperimentAnnotationTask> createExperimentAnnotationTask(@RequestBody CreateExperimentAnnotationTaskRequest request) {
        // 实验标注任务创建逻辑
    }
    
    @PostMapping("/task/{taskId}/result")
    @ApiOperation("提交实验标注结果")
    public R<Void> submitExperimentAnnotationResult(@PathVariable String taskId, @RequestBody SubmitExperimentAnnotationResultRequest request) {
        // 实验标注结果提交逻辑
    }
    
    @GetMapping("/experiment/{experimentId}/tasks")
    @ApiOperation("获取实验标注任务列表")
    public R<List<ExperimentAnnotationTask>> getExperimentAnnotationTasks(@PathVariable String experimentId) {
        // 实验标注任务列表查询
    }
    
    @GetMapping("/task/{taskId}/progress")
    @ApiOperation("获取实验标注任务进度")
    public R<ExperimentAnnotationTaskProgress> getExperimentAnnotationTaskProgress(@PathVariable String taskId) {
        // 实验标注任务进度查询
    }
    
    @PostMapping("/task/{taskId}/validate")
    @ApiOperation("验证实验标注结果")
    public R<ExperimentAnnotationValidationResult> validateExperimentAnnotationResult(@PathVariable String taskId, @RequestBody ValidateExperimentAnnotationRequest request) {
        // 实验标注结果验证逻辑
    }
    
    @GetMapping("/experiment/{experimentId}/quality/metrics")
    @ApiOperation("获取实验标注质量指标")
    public R<ExperimentAnnotationQualityMetrics> getExperimentAnnotationQualityMetrics(@PathVariable String experimentId) {
        // 实验标注质量指标查询
    }
}
```

### 3. 实验驱动服务层设计

#### 3.1 实验管理核心服务
```java
public interface IExperimentService {
    Experiment createExperiment(CreateExperimentRequest request);
    Experiment applyExperimentTemplate(String templateId, ApplyTemplateRequest request);
    void startExperiment(String experimentId);
    void bindExperimentDevices(String experimentId, BindDevicesRequest request);
    void bindExperimentCages(String experimentId, BindCagesRequest request);
    void bindExperimentMice(String experimentId, BindMiceRequest request);
    ExperimentStatusResponse getExperimentStatus(String experimentId);
    ExperimentReport generateExperimentReport(String experimentId);
    List<Experiment> getExperimentList(ExperimentQueryRequest request);
    List<Mouse> getExperimentMice(String experimentId);
}

// 实验二维码管理服务
public interface IExperimentQrCodeService {
    QrCodeGenerateResponse generateExperimentQrCode(ExperimentQrCodeGenerateRequest request);
    ExperimentQrCodeScanResponse scanExperimentQrCode(String qrCodeData);
    BatchExperimentQrCodeResponse batchGenerateExperimentQrCode(BatchExperimentQrCodeRequest request);
    List<ExperimentQrScanLog> getExperimentScanHistory(ExperimentQrScanQueryRequest request);
    List<ExperimentQrCode> getExperimentQrCodes(String experimentId);
}

// 实验设备管理服务
public interface IExperimentDeviceService {
    ExperimentDeviceRegisterResponse registerExperimentDevice(ExperimentDeviceRegisterRequest request);
    void bindDeviceToExperiment(String deviceId, String experimentId);
    void processExperimentDeviceHeartbeat(ExperimentDeviceHeartbeatRequest request);
    ExperimentDeviceConfig getExperimentDeviceConfig(String deviceId);
    void updateExperimentDeviceStatus(String deviceId, ExperimentDeviceStatusRequest request);
    List<ExperimentDevice> getExperimentDevices(String experimentId);
}

// 实验行为数据服务
public interface IExperimentBehaviorDataService {
    BatchUploadResponse processExperimentBehaviorData(BatchExperimentBehaviorDataRequest request);
    ExperimentBehaviorStatisticsResponse getExperimentBehaviorStatistics(String experimentId, ExperimentBehaviorStatisticsRequest request);
    List<ExperimentBehaviorTimelineItem> getExperimentBehaviorTimeline(String experimentId, String mouseId, ExperimentBehaviorTimelineRequest request);
    ExperimentDataQualityReport getExperimentDataQualityReport(String experimentId);
}

// 实验标注管理服务
public interface IExperimentAnnotationService {
    ExperimentAnnotationTask createExperimentAnnotationTask(CreateExperimentAnnotationTaskRequest request);
    void submitExperimentAnnotationResult(String taskId, SubmitExperimentAnnotationResultRequest request);
    List<ExperimentAnnotationTask> getExperimentAnnotationTasks(String experimentId);
    ExperimentAnnotationTaskProgress getExperimentAnnotationTaskProgress(String taskId);
    ExperimentAnnotationValidationResult validateExperimentAnnotationResult(String taskId, ValidateExperimentAnnotationRequest request);
    ExperimentAnnotationQualityMetrics getExperimentAnnotationQualityMetrics(String experimentId);
}
```

### 4. 假数据生成策略

#### 4.1 实验驱动数据初始化脚本
```sql
-- 插入实验用户数据
INSERT INTO t_experiment_user (user_id, username, password, email, real_name, institution, research_field, status) VALUES
(1, 'admin', '$2a$10$7JB720yubVSOfvVWbGReyO...', 'admin@mouse-monitor.com', '系统管理员', '生物医学研究院', '系统管理', 1),
(2, 'researcher1', '$2a$10$7JB720yubVSOfvVWbGReyO...', 'researcher1@lab.com', '研究员张三', '神经科学实验室', '行为神经学', 1),
(3, 'annotator1', '$2a$10$7JB720yubVSOfvVWbGReyO...', 'annotator1@lab.com', '标注员李四', '动物实验中心', '数据标注', 1);

-- 插入实验模板数据
INSERT INTO t_experiment_template (template_id, template_name, description, category, config_schema, default_config, status) VALUES
('tmpl_001', '标准行为观察模板', '用于标准小鼠行为观察实验的模板', '行为学研究', '{"duration":30,"intervals":5}', '{"environment":"标准环境","lighting":"正常光照"}', 1),
('tmpl_002', '学习记忆测试模板', '用于小鼠学习记忆能力测试的模板', '认知研究', '{"duration":60,"trials":10}', '{"maze_type":"T型迷宫","reward_type":"食物奖励"}', 1);

-- 插入实验项目数据
INSERT INTO t_experiment (experiment_id, experiment_name, description, researcher_name, institution, template_id, config_json, start_time, end_time, status, qr_code_batch) VALUES
('exp_001', '阿尔茨海默病药物疗效评价', '观察AD模型小鼠在药物干预下的行为变化', '张三', '神经科学实验室', 'tmpl_001', '{"drug_dose":"10mg/kg","treatment_duration":"14天"}', '2024-12-01 09:00:00', '2024-12-15 18:00:00', 1, 'BATCH_20241201_001'),
('exp_002', '抗抑郁药物行为学研究', '评估新型抗抑郁药物对小鼠行为的影响', '李四', '药理学实验室', 'tmpl_002', '{"drug_type":"SSRI","behavioral_tests":["强迫游泳","悬尾测试"]}', '2024-12-01 14:00:00', '2024-12-20 18:00:00', 1, 'BATCH_20241201_002');

-- 插入实验设备数据
INSERT INTO t_experiment_device (device_id, device_name, device_type, location, current_experiment_id, experiment_history, status) VALUES
('dev_001', '实验采集端-实验室A-001', 'video_capture', '实验室A', 'exp_001', '["exp_001"]', 1),
('dev_002', '实验采集端-实验室A-002', 'video_capture', '实验室A', 'exp_001', '["exp_001"]', 1),
('dev_003', '实验采集端-实验室B-001', 'video_capture', '实验室B', 'exp_002', '["exp_002"]', 1);

-- 插入实验鼠笼数据
INSERT INTO t_experiment_cage (cage_id, cage_name, experiment_id, device_id, cage_type, capacity, current_count, bind_time, bind_status) VALUES
('cage_001', '实验笼A-001', 'exp_001', 'dev_001', 'standard', 5, 5, '2024-12-01 08:00:00', 'BOUND'),
('cage_002', '实验笼A-002', 'exp_001', 'dev_002', 'standard', 5, 4, '2024-12-01 08:00:00', 'BOUND'),
('cage_003', '实验笼B-001', 'exp_002', 'dev_003', 'enhanced', 5, 3, '2024-12-01 13:00:00', 'BOUND');

-- 插入实验小鼠数据
INSERT INTO t_experiment_mouse (mouse_id, mouse_name, cage_id, experiment_id, strain, gender, age, weight, experiment_group, bind_time, bind_status) VALUES
('mouse_001', 'C57BL/6-001', 'cage_001', 'exp_001', 'C57BL/6', 'M', 8, 25.5, 'GROUP_A', '2024-12-01 08:00:00', 'BOUND'),
('mouse_002', 'C57BL/6-002', 'cage_001', 'exp_001', 'C57BL/6', 'F', 8, 22.3, 'GROUP_A', '2024-12-01 08:00:00', 'BOUND'),
('mouse_003', 'C57BL/6-003', 'cage_001', 'exp_001', 'C57BL/6', 'M', 9, 26.1, 'GROUP_B', '2024-12-01 08:00:00', 'BOUND'),
('mouse_004', 'C57BL/6-004', 'cage_001', 'exp_001', 'C57BL/6', 'F', 8, 21.8, 'GROUP_B', '2024-12-01 08:00:00', 'BOUND'),
('mouse_005', 'C57BL/6-005', 'cage_001', 'exp_001', 'C57BL/6', 'M', 8, 24.9, 'GROUP_A', '2024-12-01 08:00:00', 'BOUND');

-- 插入实验二维码数据
INSERT INTO t_experiment_qr_code (qr_code_data, qr_code_type, target_id, experiment_id, image_url, status, description) VALUES
('EXP_exp_001_MOUSE_mouse_001', 'mouse', 'mouse_001', 'exp_001', '/qrcode/exp_001_mouse_001.png', 1, '实验exp_001-C57BL/6-001小鼠标识码'),
('EXP_exp_001_MOUSE_mouse_002', 'mouse', 'mouse_002', 'exp_001', '/qrcode/exp_001_mouse_002.png', 1, '实验exp_001-C57BL/6-002小鼠标识码'),
('EXP_exp_001_MOUSE_mouse_003', 'mouse', 'mouse_003', 'exp_001', '/qrcode/exp_001_mouse_003.png', 1, '实验exp_001-C57BL/6-003小鼠标识码'),
('EXP_exp_001_MOUSE_mouse_004', 'mouse', 'mouse_004', 'exp_001', '/qrcode/exp_001_mouse_004.png', 1, '实验exp_001-C57BL/6-004小鼠标识码'),
('EXP_exp_001_MOUSE_mouse_005', 'mouse', 'mouse_005', 'exp_001', '/qrcode/exp_001_mouse_005.png', 1, '实验exp_001-C57BL/6-005小鼠标识码'),
('EXP_exp_001_CAGE_cage_001', 'cage', 'cage_001', 'exp_001', '/qrcode/exp_001_cage_001.png', 1, '实验exp_001-实验笼A-001标识码'),
('EXP_exp_001_CAGE_cage_002', 'cage', 'cage_002', 'exp_001', '/qrcode/exp_001_cage_002.png', 1, '实验exp_001-实验笼A-002标识码'),
('EXP_exp_002_CAGE_cage_003', 'cage', 'cage_003', 'exp_002', '/qrcode/exp_002_cage_003.png', 1, '实验exp_002-实验笼B-001标识码'),
('EXP_exp_001_DEVICE_dev_001', 'device', 'dev_001', 'exp_001', '/qrcode/exp_001_dev_001.png', 1, '实验exp_001-采集端-实验室A-001设备码'),
('EXP_exp_001_DEVICE_dev_002', 'device', 'dev_002', 'exp_001', '/qrcode/exp_001_dev_002.png', 1, '实验exp_001-采集端-实验室A-002设备码'),
('EXP_exp_002_DEVICE_dev_003', 'device', 'dev_003', 'exp_002', '/qrcode/exp_002_dev_003.png', 1, '实验exp_002-采集端-实验室B-001设备码');

-- 插入实验扫描记录数据
INSERT INTO t_experiment_qr_scan_log (qr_code_data, experiment_id, scan_user_id, device_info, location, scan_time, scan_result, experiment_context) VALUES
('EXP_exp_001_MOUSE_mouse_001', 'exp_001', '2', 'iPhone 12', '实验室A', '2024-12-01 10:30:00', 'success', '实验开始前小鼠确认'),
('EXP_exp_001_CAGE_cage_001', 'exp_001', '2', 'iPhone 12', '实验室A', '2024-12-01 10:31:00', 'success', '实验笼位置确认'),
('EXP_exp_001_DEVICE_dev_001', 'exp_001', '1', 'Android Phone', '实验室A', '2024-12-01 11:00:00', 'success', '设备状态检查');

-- 插入实验行为数据样本
INSERT INTO t_experiment_behavior_data (mouse_id, device_id, cage_id, experiment_id, timestamp, position_x, position_y, behavior_type, behavior_confidence, experiment_phase, data_quality) VALUES
('mouse_001', 'dev_001', 'cage_001', 'exp_001', '2024-12-01 10:00:00', 120.5, 80.3, 'exploring', 0.85, 'baseline', 'good'),
('mouse_002', 'dev_001', 'cage_001', 'exp_001', '2024-12-01 10:00:05', 95.2, 110.7, 'grooming', 0.92, 'baseline', 'good'),
('mouse_003', 'dev_001', 'cage_001', 'exp_001', '2024-12-01 10:00:10', 150.8, 60.1, 'resting', 0.78, 'baseline', 'good');

-- 插入实验标注任务数据
INSERT INTO t_experiment_annotation_task (task_id, task_name, experiment_id, assignee_id, task_type, status, video_path, instructions, experiment_context) VALUES
('task_001', '实验exp_001行为标注-第1批', 'exp_001', '3', 'behavior_annotation', 1, '/videos/exp_001_20241201_batch1.mp4', '标注小鼠的探索、理毛、休息等行为', '基线期行为观察'),
('task_002', '实验exp_001行为标注-第2批', 'exp_001', '3', 'behavior_annotation', 0, '/videos/exp_001_20241201_batch2.mp4', '标注小鼠的探索、理毛、休息等行为', '药物干预期行为观察');
```
```

#### 4.2 实验驱动假数据生成服务
```java
@Service
@Slf4j
public class ExperimentMockDataGeneratorService {
    
    @Autowired
    private IExperimentBehaviorDataService experimentBehaviorDataService;
    
    @Autowired
    private IExperimentQrCodeService experimentQrCodeService;
    
    @Autowired
    private IExperimentService experimentService;
    
    @PostConstruct
    public void initExperimentQrCodes() {
        log.info("开始生成实验二维码数据...");
        
        // 为实验exp_001生成二维码
        String experimentId = "exp_001";
        
        // 为实验小鼠生成二维码
        List<String> mouseIds = Arrays.asList("mouse_001", "mouse_002", "mouse_003", "mouse_004", "mouse_005");
        for (String mouseId : mouseIds) {
            ExperimentQrCodeGenerateRequest request = new ExperimentQrCodeGenerateRequest();
            request.setQrCodeType("mouse");
            request.setTargetId(mouseId);
            request.setExperimentId(experimentId);
            experimentQrCodeService.generateExperimentQrCode(request);
        }
        
        // 为实验鼠笼生成二维码
        List<String> cageIds = Arrays.asList("cage_001", "cage_002", "cage_003");
        for (String cageId : cageIds) {
            ExperimentQrCodeGenerateRequest request = new ExperimentQrCodeGenerateRequest();
            request.setQrCodeType("cage");
            request.setTargetId(cageId);
            request.setExperimentId(experimentId);
            experimentQrCodeService.generateExperimentQrCode(request);
        }
        
        // 为实验设备生成二维码
        List<String> deviceIds = Arrays.asList("dev_001", "dev_002", "dev_003");
        for (String deviceId : deviceIds) {
            ExperimentQrCodeGenerateRequest request = new ExperimentQrCodeGenerateRequest();
            request.setQrCodeType("device");
            request.setTargetId(deviceId);
            request.setExperimentId(experimentId);
            experimentQrCodeService.generateExperimentQrCode(request);
        }
        
        log.info("实验二维码数据生成完成");
    }
    
    @Scheduled(fixedRate = 30000) // 每30秒生成一次实验假数据
    public void generateExperimentMockBehaviorData() {
        String experimentId = "exp_001";
        List<String> mouseIds = Arrays.asList("mouse_001", "mouse_002", "mouse_003", "mouse_004", "mouse_005");
        List<String> behaviors = Arrays.asList("exploring", "grooming", "resting", "eating", "drinking", "social_interaction");
        List<String> experimentPhases = Arrays.asList("baseline", "treatment", "recovery");
        
        BatchExperimentBehaviorDataRequest request = new BatchExperimentBehaviorDataRequest();
        request.setBatchId("exp_batch_" + System.currentTimeMillis());
        request.setExperimentId(experimentId);
        request.setDeviceId("dev_001");
        request.setCageId("cage_001");
        request.setTimestamp(System.currentTimeMillis());
        
        List<ExperimentBehaviorDataItem> dataList = new ArrayList<>();
        
        for (String mouseId : mouseIds) {
            ExperimentBehaviorDataItem item = new ExperimentBehaviorDataItem();
            item.setMouseId(mouseId);
            item.setExperimentId(experimentId);
            item.setTimestamp(System.currentTimeMillis());
            
            // 随机位置
            Position position = new Position();
            position.setX(Math.random() * 200);
            position.setY(Math.random() * 200);
            position.setConfidence(0.8 + Math.random() * 0.2);
            item.setPosition(position);
            
            // 随机行为
            Map<String, BehaviorDetection> behaviorMap = new HashMap<>();
            String activeBehavior = Math.random() < 0.3 ? behaviors.get((int)(Math.random() * behaviors.size())) : null;
            
            for (String behavior : behaviors) {
                BehaviorDetection detection = new BehaviorDetection();
                if (behavior.equals(activeBehavior)) {
                    detection.setDetected(true);
                    detection.setConfidence(0.7 + Math.random() * 0.25);
                    detection.setDuration((int)(Math.random() * 300) + 5);
                } else {
                    detection.setDetected(false);
                    detection.setConfidence(Math.random() * 0.3);
                }
                behaviorMap.put(behavior, detection);
            }
            item.setBehaviors(behaviorMap);
            
            // 运动数据
            MotionData motionData = new MotionData();
            motionData.setVelocity(activeBehavior != null && !"resting".equals(activeBehavior) ? Math.random() * 5 : Math.random() * 0.2);
            motionData.setAcceleration((Math.random() - 0.5) * 2);
            motionData.setDirection(Math.random() * 360);
            item.setMotionData(motionData);
            
            // 实验相关数据
            item.setExperimentPhase(experimentPhases.get((int)(Math.random() * experimentPhases.size())));
            item.setDataQuality(Math.random() > 0.1 ? "good" : "poor");
            
            dataList.add(item);
        }
        
        request.setData(dataList);
        
        try {
            experimentBehaviorDataService.batchUploadExperimentBehaviorData(request);
            log.info("生成实验假数据成功，实验ID: {}, 批次ID: {}", experimentId, request.getBatchId());
        } catch (Exception e) {
            log.error("生成实验假数据失败", e);
        }
    }
    
    /**
     * 为指定实验生成完整的测试数据集
     */
    public void generateCompleteExperimentDataset(String experimentId, int daysCount) {
        log.info("开始为实验 {} 生成 {} 天的完整数据集...", experimentId, daysCount);
        
        Date startDate = new Date();
        Calendar calendar = Calendar.getInstance();
        calendar.setTime(startDate);
        
        for (int day = 0; day < daysCount; day++) {
            // 每天生成24小时的数据，每小时生成12个数据点（每5分钟一个）
            for (int hour = 0; hour < 24; hour++) {
                for (int interval = 0; interval < 12; interval++) {
                    generateHourlyExperimentData(experimentId, calendar.getTime());
                    calendar.add(Calendar.MINUTE, 5);
                }
            }
        }
        
        log.info("实验 {} 的完整数据集生成完成", experimentId);
    }
    
    /**
     * 生成每小时的实验数据
     */
    private void generateHourlyExperimentData(String experimentId, Date timestamp) {
        List<String> mouseIds = Arrays.asList("mouse_001", "mouse_002", "mouse_003", "mouse_004", "mouse_005");
        
        for (String mouseId : mouseIds) {
            ExperimentBehaviorData data = generateExperimentFakeBehaviorData(experimentId, mouseId);
            data.setTimestamp(timestamp);
            experimentBehaviorDataService.saveExperimentBehaviorData(data);
        }
    }
    
    /**
     * 生成实验假行为数据
     */
    private ExperimentBehaviorData generateExperimentFakeBehaviorData(String experimentId, String mouseId) {
        Random random = new Random();
        List<String> behaviorTypes = Arrays.asList("exploring", "grooming", "resting", "eating", "drinking", "social_interaction");
        List<String> experimentPhases = Arrays.asList("baseline", "treatment", "recovery");
        List<String> dataQualities = Arrays.asList("excellent", "good", "fair", "poor");
        
        ExperimentBehaviorData data = new ExperimentBehaviorData();
        data.setMouseId(mouseId);
        data.setExperimentId(experimentId);
        data.setDeviceId("dev_" + String.format("%03d", random.nextInt(3) + 1));
        data.setCageId("cage_" + String.format("%03d", random.nextInt(3) + 1));
        data.setTimestamp(new Date());
        data.setPositionX(random.nextDouble() * 200);
        data.setPositionY(random.nextDouble() * 150);
        data.setBehaviorType(behaviorTypes.get(random.nextInt(behaviorTypes.size())));
        data.setBehaviorConfidence(0.7 + random.nextDouble() * 0.3);
        data.setExperimentPhase(experimentPhases.get(random.nextInt(experimentPhases.size())));
        data.setDataQuality(dataQualities.get(random.nextInt(dataQualities.size())));
        
        return data;
    }
}
```

## 第二个月开始：团队协作阶段

### 新成员加入计划

#### 第5周：团队扩展
- [ ] 新成员技术培训
- [ ] 代码规范和工作流培训
- [ ] 任务分工和协作机制建立
- [ ] Python采集端开发启动

#### 第6-8周：并行开发
- [ ] **后端开发**：数据分析模块、性能优化、二维码批量管理功能
- [ ] **前端开发**：移动端uni-app开发、二维码扫描和生成界面
- [ ] **Python端开发**：视频采集和行为识别、二维码识别集成
- [ ] **数据标注**：标注工具使用培训，标注任务开始

### 数据标注计划

#### 标注准备阶段（第5周）
- [ ] CVAT标注工具部署和配置
- [ ] 标注规范制定
- [ ] 标注人员培训
- [ ] 标注质量控制流程建立

#### 标注执行阶段（第6-12周）
- [ ] 收集小鼠视频数据
- [ ] 执行行为标注任务
- [ ] 质量检查和数据清洗
- [ ] 标注数据集构建

## 风险控制与应对策略

### 技术风险
1. **AI模型训练效果不佳**
   - 应对：准备多种算法方案，建立模型评估体系
   
2. **实时性能不满足要求**
   - 应对：分阶段性能测试，及时优化瓶颈
   
3. **数据质量问题**
   - 应对：建立数据验证机制，多重质量检查

### 进度风险
1. **开发进度延迟**
   - 应对：采用敏捷开发，定期评估和调整
   
2. **人员技能不匹配**
   - 应对：提前技能评估，制定培训计划

### 质量风险
1. **系统稳定性问题**
   - 应对：完善测试体系，建立监控机制
   
2. **用户体验不佳**
   - 应对：早期用户反馈，迭代优化

## 成功标准

### 第一个月目标
- [ ] Spring Boot后端核心功能完成度 ≥ 80%
- [ ] 二维码生成、识别、管理功能完整实现
- [ ] 假数据驱动的完整业务流程可演示
- [ ] API接口覆盖率 ≥ 90%
- [ ] 单元测试覆盖率 ≥ 70%

### 第二个月目标
- [ ] Python采集端基础功能完成（含二维码识别）
- [ ] 前端主要功能模块完成（含移动端二维码扫描）
- [ ] 数据标注流程建立
- [ ] 二维码与实体对象绑定关系完善
- [ ] 系统集成测试通过

### 整体项目目标
- [ ] 系统功能完整性 ≥ 95%
- [ ] 性能指标达到设计要求
- [ ] 用户满意度 ≥ 85%
- [ ] 代码质量评级 ≥ A级

通过这个详细的里程碑规划，我们可以确保项目按时、按质完成，同时为团队协作和后续扩展奠定坚实基础。