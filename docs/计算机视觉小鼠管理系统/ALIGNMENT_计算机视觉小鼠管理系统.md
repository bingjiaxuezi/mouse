# 基于计算机视觉的实验小鼠管理系统需求对齐文档

## 项目特性规范

### 项目定位
本项目是基于现有小鼠行为监测系统的扩展开发，旨在通过计算机视觉技术实现自动化的实验小鼠管理和数据采集。项目采用渐进式开发策略，在现有稳定架构基础上逐步集成计算机视觉功能。

### 现有项目架构分析

#### 技术栈现状
- **后端框架**: RuoYi (Spring Boot 2.5.15 + MyBatis)
- **前端技术**: Thymeleaf + jQuery + Bootstrap
- **数据库**: MySQL 8.0
- **缓存**: Redis
- **文件存储**: MinIO
- **部署**: Docker Compose
- **权限管理**: Apache Shiro

#### 已实现核心模块
✅ **基础架构层**
- Spring Boot 后端服务框架
- MySQL 数据库设计
- Redis 缓存系统
- MinIO 文件存储
- Docker 容器化部署
- 自动化部署脚本

✅ **业务功能层**
- 用户权限管理系统
- 小鼠基础信息管理 (t_mouse)
- 行为数据记录系统 (t_behavior_data)
- 行为类型字典管理 (t_behavior_type)
- 位置追踪数据 (t_position_track)
- 生理状态监测 (t_physiological_state)

✅ **前端展示层**
- 系统管理界面
- 小鼠管理页面
- 行为记录展示系统
- 数据统计和图表功能

#### 数据库设计现状
```sql
-- 核心业务表
t_mouse              -- 小鼠基础信息
t_behavior_data      -- 行为数据记录
t_behavior_type      -- 行为类型字典(19种行为类型)
t_position_track     -- 位置轨迹数据
t_physiological_state -- 生理状态数据
t_device            -- 设备管理
t_experiment        -- 实验管理
```

## 原始需求分析

### 核心业务场景详细分解

#### 1. 笼子管理场景
**现状评估**: 🔄 部分实现
- ✅ 已有设备管理表 (t_device)
- ❌ 缺少笼子与小鼠的关联管理
- ❌ 缺少笼子状态监控
- ❌ 缺少二维码识别功能

**需求细化**:
- 笼子信息管理 (编号、位置、容量、状态)
- 笼子与小鼠的动态关联
- 二维码生成和识别
- 笼子环境参数监控

#### 2. 智能小鼠识别场景
**现状评估**: ❌ 未实现
- ❌ 缺少计算机视觉识别模块
- ❌ 缺少图像处理算法
- ❌ 缺少实时视频流处理

**需求细化**:
- 小鼠个体识别算法
- 实时视频流分析
- 特征提取和匹配
- 识别结果验证机制

#### 3. 实验流程管理场景
**现状评估**: 🔄 部分实现
- ✅ 已有实验管理表 (t_experiment)
- ❌ 缺少实验流程自动化
- ❌ 缺少实验数据自动采集

**需求细化**:
- 实验方案配置管理
- 实验流程自动化执行
- 实验数据自动采集和关联
- 实验结果自动分析

#### 4. 数据采集与处理场景
**现状评估**: 🔄 部分实现
- ✅ 已有行为数据记录功能
- ✅ 已有位置追踪数据结构
- ❌ 缺少实时数据采集端
- ❌ 缺少计算机视觉数据处理

**需求细化**:
- 实时视频数据采集
- 行为识别算法集成
- 数据预处理和清洗
- 异常数据检测和处理

#### 5. 报表与数据导出场景
**现状评估**: 🔄 部分实现
- ✅ 已有基础数据展示功能
- ✅ 已有行为统计图表
- ❌ 缺少高级数据分析报表
- ❌ 缺少多格式数据导出

**需求细化**:
- 实验报告自动生成
- 多维度数据分析图表
- Excel/PDF 格式导出
- 数据可视化仪表板

## 边界确认

### 明确任务范围

#### 第一阶段 (当前阶段) - 系统架构完善
✅ **包含范围**:
- 完善现有数据库设计
- 优化后端API接口
- 完善前端展示功能
- 集成测试和部署优化

❌ **排除范围**:
- 计算机视觉算法开发
- 硬件设备集成
- 实时视频处理

#### 第二阶段 (规划阶段) - 计算机视觉集成
📋 **规划范围**:
- Python 数据采集端开发
- 计算机视觉算法集成
- 实时数据处理管道
- 硬件设备接口开发

## 需求理解

### 已实现功能评估

#### ✅ 完全实现
1. **基础架构**: Spring Boot + MySQL + Redis + Docker
2. **用户管理**: 完整的权限控制系统
3. **小鼠管理**: 基础信息的增删改查
4. **行为记录**: 行为数据的展示和统计
5. **数据库设计**: 完整的业务表结构

#### 🔄 部分实现
1. **设备管理**: 有基础表结构，缺少完整业务逻辑
2. **实验管理**: 有数据表，缺少流程管理
3. **数据导出**: 有基础功能，缺少高级报表
4. **数据可视化**: 有基础图表，缺少高级分析

#### ❌ 未实现
1. **计算机视觉模块**: 完全缺失
2. **实时数据采集**: 缺少采集端
3. **自动化识别**: 缺少AI算法
4. **硬件集成**: 缺少设备接口
5. **实时监控**: 缺少实时数据流

### 技术架构现状

#### 后端服务现状
- ✅ RESTful API 设计规范
- ✅ 分层架构 (Controller-Service-Mapper)
- ✅ 统一异常处理
- ✅ 权限控制集成
- ✅ 数据验证和转换

#### 前端应用现状
- ✅ 响应式页面布局
- ✅ AJAX 异步交互
- ✅ 数据表格和分页
- ✅ 基础图表展示
- ❌ 缺少实时数据更新
- ❌ 缺少高级交互组件

#### 数据存储现状
- ✅ MySQL 主数据库
- ✅ Redis 缓存系统
- ✅ MinIO 文件存储
- ❌ 缺少时序数据库 (用于实时数据)
- ❌ 缺少图像数据存储优化

## 疑问澄清

### 技术实现相关

#### Q1: 计算机视觉技术栈选择
**建议方案**: 
- Python + OpenCV + PyTorch/TensorFlow
- 通过 REST API 与现有 Java 后端集成
- 使用 Docker 容器独立部署

#### Q2: 实时数据处理架构
**建议方案**:
- 使用 WebSocket 实现实时数据推送
- 集成消息队列 (Redis Pub/Sub 或 RabbitMQ)
- 采用事件驱动架构

#### Q3: 硬件设备集成方式
**建议方案**:
- 通过 USB/网络摄像头采集视频
- 使用串口/网络协议连接传感器
- 标准化设备接口协议

### 业务流程相关

#### Q4: 数据采集频率和存储策略
**建议方案**:
- 视频数据: 30fps 采集，关键帧存储
- 行为数据: 实时识别，异步存储
- 历史数据: 分级存储，定期归档

#### Q5: 系统集成和部署策略
**建议方案**:
- 微服务架构，独立部署各模块
- 使用 Docker Compose 统一编排
- 支持水平扩展和负载均衡

## 技术约束

### 系统兼容性约束
- 必须与现有 RuoYi 框架保持兼容
- 数据库结构变更需要向后兼容
- API 接口需要保持版本兼容性
- 前端页面需要保持现有用户体验

### 性能约束
- 视频处理延迟 < 100ms
- 数据库查询响应时间 < 500ms
- 系统并发支持 > 50 用户
- 数据存储支持 TB 级别

### 安全约束
- 集成现有 Shiro 权限系统
- 数据传输加密 (HTTPS/WSS)
- 敏感数据脱敏处理
- 操作日志完整记录

## 集成方案

### 与现有系统集成

#### 数据库集成
- 扩展现有表结构，添加计算机视觉相关字段
- 新增视频数据和图像特征表
- 保持现有数据完整性和一致性

#### API 集成
- 扩展现有 Controller，添加视觉识别接口
- 新增 Python 服务的代理接口
- 保持 RESTful 设计规范

#### 前端集成
- 在现有页面添加实时监控组件
- 新增视频流展示和控制界面
- 保持现有页面布局和交互模式

### 外部系统集成

#### 计算机视觉服务
- Python 独立服务，通过 HTTP API 通信
- 支持多种视觉算法模型
- 提供标准化的识别结果格式

#### 硬件设备集成
- 摄像头设备标准化接口
- 传感器数据采集协议
- 设备状态监控和故障处理

## 验收标准

### 功能完整性
- [ ] 所有核心业务场景功能实现
- [ ] 计算机视觉识别准确率 > 90%
- [ ] 实时数据采集和处理正常
- [ ] 系统集成测试通过

### 技术规范
- [ ] 代码质量符合项目规范
- [ ] API 文档完整准确
- [ ] 数据库设计规范化
- [ ] 安全测试通过

### 部署要求
- [ ] Docker 一键部署成功
- [ ] 系统性能指标达标
- [ ] 监控和日志系统正常
- [ ] 备份和恢复机制完善

## 确认事项

### 关键假设确认
1. **技术栈**: 继续使用现有 Java + MySQL 架构，Python 作为辅助服务
2. **部署方式**: 继续使用 Docker Compose，支持微服务扩展
3. **数据存储**: 继续使用 MySQL 主库，考虑添加时序数据库
4. **用户界面**: 继续使用 Thymeleaf，逐步引入现代前端组件

### 风险评估
1. **技术风险**: 计算机视觉算法复杂度高，需要专业团队
2. **性能风险**: 实时视频处理对硬件要求较高
3. **集成风险**: 新旧系统集成可能存在兼容性问题
4. **数据风险**: 大量视频数据存储和处理成本较高

### 下一步行动
1. 完成当前阶段的系统优化和测试
2. 制定计算机视觉模块的详细技术方案
3. 准备硬件设备和开发环境
4. 组建计算机视觉开发团队
5. 制定分阶段开发和测试计划