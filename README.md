# 小鼠行为监测系统项目

## 项目概述

本项目旨在开发一套自动化系统，用于在自然饲养环境下对小老鼠进行24小时无干扰状态监测与行为统计，重点关注对医学/药理学研究更具价值的特定状态（如睡眠、排便、咳嗽、抽搐、挠鼻等），以支持药物疗效评价等研究。

## 核心价值

- **医学研究价值**：识别对疾病和药物反应更敏感的行为状态，填补行为学衰老指标空白
- **科研效率革命**：24小时自动化监测，释放研究人员精力，解决传统"测速点"式观察局限
- **巨大市场潜力**：
  - 中国睡眠经济市场规模2024年突破5000亿，科研应用潜力巨大
  - 动物实验行为观察市场预估30亿+（2024年）
  - 宠物行为监测市场快速增长
  - 自闭症、衰老等疾病研究的刚性需求
- **显著成本节约**：自动化统计降低人工成本十倍甚至二十倍
- **世界首创机会**：开创性的24小时无干扰行为学指标体系

## 技术架构

- **数据采集端**：Python + OpenCV + YOLO + DeepSORT
- **后端服务**：Spring Boot + MySQL + Redis
- **前端展示**：Vue 3 + Element Plus
- **移动端**：uni-app（可选）

## 文档结构

### docs/ 文件夹包含以下核心文档：

1. **[技术选型建议.md](./docs/技术选型建议.md)**
   - Python数据采集端技术选型（OpenCV、YOLO、DeepSORT等）
   - Spring Boot后端脚手架推荐
   - 其他组件选型建议（MySQL、Vue.js、uni-app等）
   - 许可证兼容性分析
   - 风险评估和开发建议

2. **[系统设计文档.md](./docs/系统设计文档.md)**
   - 系统架构图和数据流向
   - 核心模块设计（采集端、后端、前端）
   - 关键接口定义（RESTful API、WebSocket）
   - 数据库设计
   - 部署架构和性能指标
   - 安全设计

3. **[通俗技术介绍.md](./docs/通俗技术介绍.md)**
   - 面向医学研究人员的非技术说明
   - 系统工作原理解释
   - 解决的问题和带来的价值
   - 使用场景和投资回报分析
   - 常见问题解答

## 系统登录信息

**若依管理系统登录信息：**
- 用户名：`admin`
- 密码：`admin`
- 访问地址：http://localhost:8080

**注意事项：**
- 系统已禁用验证码功能，可直接使用用户名密码登录
- 首次登录后建议修改默认密码
- 系统集成了完整的权限管理功能

## 项目状态

**当前阶段**：后端核心功能开发完成，系统可完整运行 ✅

### 最新进展（2025-01-22）
- ✅ **行为类型分布图表功能开发完成**
  - 设计并实现行为类型分布统计的专门后端接口
  - 支持时间范围查询和数据筛选功能
  - 修改前端页面，集成新的后端接口
  - 添加时间范围选择功能，提升用户体验
  - 完成行为类型分布图表功能的完整性和准确性测试
  - 修复接口权限问题，确保前端能正常访问数据

### 历史进展（2025-01-21）
- ✅ **小鼠管理系统核心功能修复**
  - 修复出生时间筛选问题（日期格式错误）
  - 修复编辑和新增小鼠后页面跳转问题
  - 优化表格刷新机制，保持筛选条件
- ✅ **完整的自动化部署体系**
  - 一键启动脚本 `quick-start.ps1`
  - 开发部署脚本 `deploy.ps1`
  - 环境检查脚本 `check-environment.ps1`
  - Docker容器化部署完全就绪
- ✅ **项目文档体系完善**
  - 详细的部署指南和使用说明
  - 完整的故障排除文档
  - 开发者友好的快速开始指南

### 已完成功能模块
- ✅ **基础架构**
  - RuoYi后端框架集成
  - Docker环境配置
  - MySQL数据库设计和初始化
  - Redis缓存配置
- ✅ **核心业务模块**
  - 小鼠信息管理（增删改查、批量操作）
  - 实验管理（实验设计、参数配置）
  - 设备管理（设备注册、状态监控）
  - 行为数据管理（数据存储、查询统计）
- ✅ **接口规范统一**
  - 统一使用 `@PostMapping("/XXX")` 接口风格
  - 修复删除接口400错误问题
  - 完成所有Controller统一改造
- ✅ **自动化部署**
  - 一键编译部署脚本
  - Docker容器化部署
  - 数据库自动初始化
  - 服务健康检查

### 进行中
- 🔄 **Excel导出功能优化**：在导出的Excel文件中包含小鼠照片图片
- 🔄 **前端界面优化**：提升用户体验和界面美观度
- 🔄 **系统性能优化**：数据库查询优化和缓存策略改进

### 下一阶段计划
- ⏳ **Python数据采集端开发**：基于OpenCV和YOLO的视频分析模块
- ⏳ **行为识别算法集成**：深度学习模型训练和部署
- ⏳ **前端Vue.js应用开发**：现代化的Web管理界面
- ⏳ **移动端应用开发**：uni-app跨平台移动应用
- ⏳ **系统集成测试**：端到端功能测试和性能测试

## 快速开始

123### 环境要求
- **Docker Desktop**：用于容器化部署
- **PowerShell**：Windows环境下的脚本执行
- **Git**：用于克隆项目代码
- **Java 8+**：后端开发环境（可选，Docker部署时不需要）

### 从GitHub克隆项目后的完整启动流程

#### 1. 克隆项目
```bash
git clone https://github.com/your-username/mouse.git
cd mouse
```

#### 2. 环境检查（推荐）
```powershell
# 检查Docker、PowerShell等环境是否就绪
.\scripts\check-environment.ps1
```

#### 3. 一键启动后端服务（推荐方式）
```powershell
# 在项目根目录执行，自动完成所有初始化工作
.\scripts\quick-start.ps1
```

**该脚本会自动完成：**
- 检查Docker环境
- 构建后端Docker镜像
- 启动MySQL、Redis、后端服务
- 初始化数据库
- 显示服务状态和访问地址

#### 4. 访问系统
服务启动后访问：**http://localhost:8092**

### Docker手动部署方式

如果需要手动控制部署过程：

```powershell
# 1. 进入docker目录
cd docker

# 2. 启动所有服务
docker-compose up -d

# 3. 查看服务状态
docker-compose ps

# 4. 查看日志
docker-compose logs -f mouse-backend
```

### 开发模式部署

开发过程中需要频繁重新部署：

```powershell
# 一键编译部署脚本（开发专用）
.\scripts\deploy.ps1
```

**该脚本功能：**
- 自动编译打包Spring Boot项目
- 重新构建Docker镜像
- 重启后端服务
- 保持数据库数据不丢失

### 脚本工具详解

项目提供了完整的自动化脚本，位于 `scripts/` 目录：

| 脚本名称 | 功能描述 | 使用场景 |
|---------|---------|----------|
| **`quick-start.ps1`** | 一键启动整个后端环境 | 首次部署、完整重启 |
| **`deploy.ps1`** | 一键编译部署 | 开发调试、代码更新 |
| **`check-environment.ps1`** | 环境检查和诊断 | 问题排查、环境验证 |
| **`init-database.ps1`** | 数据库初始化 | 数据库重置、首次安装 |
| **`start-backend.ps1`** | 手动启动后端服务 | 单独启动后端 |

### 常见问题解决

#### Docker相关问题
```powershell
# 检查Docker是否运行
docker version

# 清理Docker缓存（解决构建问题）
docker system prune -f

# 重新构建镜像
cd docker
docker-compose build --no-cache
```

#### 端口冲突问题
```powershell
# 检查端口占用
netstat -ano | findstr :8092
netstat -ano | findstr :3306
netstat -ano | findstr :6379

# 停止所有服务
cd docker
docker-compose down
```

#### 权限问题
```powershell
# 以管理员身份运行PowerShell
# 或者设置执行策略
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

详细使用说明请参考：[scripts/README.md](./scripts/README.md)

**已完成**：
- ✅ 技术选型调研和建议
- ✅ 系统架构设计
- ✅ 核心模块划分
- ✅ 关键接口定义
- ✅ 数据库设计
- ✅ 通俗技术介绍文档

**下一步计划**：
1. 评估技术选型和设计方案
2. 搭建开发环境
3. 实现基础框架
4. 开发核心功能模块

## 关键特性

### 监测能力
- 24小时不间断、非侵入式监测
- 红外摄像头解决夜间监测问题
- 复杂垫料背景下的准确识别
- 同时追踪5只小鼠并准确区分
- **核心行为识别（19种）**：
  1. 睡眠（可区分死亡状态）
  2. 进食
  3. 饮水
  4. 排便
  5. 咳嗽（挠鼻）
  6. 舔前爪
  7. 舔后足
  8. 舔毛（自我理毛）
  9. 走动（含运动距离、平均速度、运动轨迹、中央区域活动度）
  10. 站立
  11. 社交互动（鼠间接触、互相舔毛嬉戏）
  12. 跟随行为
  13. 转圈行为
  14. 跳跃
  15. 攻击
  16. 交配（含同性骑跨等近似交配）
  17. 呕吐或打嗝
  18. 重复刻板行为
  19. 静息（不动且不睡）
- **生理状态估测（3种）**：
  1. 体重估测
  2. 体温测量
  3. 体表情况（脱毛、血染、毛发变色等）

### 数据分析
- 行为状态量化统计（频率、时长、时间段）
- 按时间段、个体、组别汇总分析
- 支持药物疗效评价研究
- 实时数据推送和历史数据查询

### 系统优势
- 高精度识别（>90%准确率）
- 多任务并行处理
- 持续学习和改进能力
- 完整的数据记录和追溯

## 技术亮点

1. **多目标追踪**：解决同笼多鼠的身份识别和追踪问题
2. **细微行为识别**：突破传统系统只能识别明显运动的局限
3. **环境适应性**：在复杂垫料环境下稳定工作
4. **24小时监测**：红外技术实现夜间无干扰监测
5. **人工智能驱动**：深度学习模型持续优化识别精度

## 应用场景

- **药物疗效评价**：通过行为变化评估药物效果（如自闭症药物疗效评价）
- **疾病模型研究**：监测疾病进展过程中的行为变化
- **衰老研究**：建立行为学衰老评价指标体系
- **昼夜节律研究**：分析行为的时间分布规律
- **个体化医学研究**：识别个体间的行为差异
- **宠物行为监测**：扩展至宠物健康和行为分析市场
- **复杂经济决策研究**：如"餐厅街"觅食任务等行为经济学实验

## 联系方式

如有任何问题或建议，请通过以下方式联系：

- 项目负责人：[王嘉宁|李陈子佳]
- 邮箱：[mailtowjn@gmail.com]
- 电话：[待填写]

---

## 📋 项目当前状态

### 🎯 设计阶段完成情况
- ✅ **技术选型完成**：确定Python + Spring Boot + Vue/uni-app技术栈
- ✅ **系统架构设计完成**：完整的模块化架构和数据库设计
- ✅ **通信协议定义完成**：RESTful API和WebSocket实时通信规范
- ✅ **开发计划制定完成**：详细的8周开发里程碑规划
- ✅ **Docker部署方案完成**：容器化部署架构和配置
- ✅ **文档体系建立完成**：技术文档、用户文档、开发文档齐全
- ✅ **后端接口规范统一**：统一Controller接口风格，修复删除接口问题
- ✅ **自动化部署流程**：创建一键编译部署脚本，提升开发效率

### 🚀 即将进入开发阶段
- **第1-2周**：Spring Boot后端基础架构搭建
- **第3-4周**：核心业务模块开发
- **第5周开始**：团队扩展，Python采集端并行开发
- **第6周开始**：数据标注工作启动

### 📊 开发进度预期
- **第1个月目标**：Spring Boot后端核心功能完成度 ≥ 80%
- **第2个月目标**：完整系统集成，Python采集端基础功能完成
- **预计完成时间**：2个月内完成MVP版本

**状态**：✅ 设计阶段完成，准备进入开发阶段